/* Game Screen Layout */
.game-screen {
  padding: 0;
  height: 100vh;
  overflow: hidden;
  display: flex;
  flex-direction: column;
  align-items: stretch;
}

.game-middle { display: flex; flex: 1; overflow: hidden; }

.board-wrap {
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 10px;
  overflow: auto;
  position: relative;
  min-width: 0;
}

.board {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  grid-template-rows: repeat(5, 1fr);
  gap: 3px;
  width: 100%;
  max-width: 980px;
  height: 100%;
  max-height: 700px;
  background: #222;
  border: 2px solid #3a3a6a;
  border-radius: 6px;
  padding: 3px;
  box-shadow: 0 0 30px rgba(30,30,80,.4);
}

/* Cell */
.cell {
  position: relative;
  background: var(--bg3);
  border-radius: 3px;
  cursor: pointer;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  font-size: 11px;
  transition: all .12s;
  overflow: hidden;
  min-height: 40px;
}
.cell:hover { filter: brightness(1.2); z-index: 1; }

.terrain-icon {
  position: absolute;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  pointer-events: none;
  opacity: .55;
  transition: opacity .2s;
}
.terrain-icon svg { width: 65%; height: 65%; }
.cell:hover .terrain-icon { opacity: .35; }

/* Terrain types */
.cell.t-plain {
  background: linear-gradient(170deg, #4a7a4a 0%, #3a6a3a 40%, #4a7a4a 100%);
  background-image: repeating-linear-gradient(90deg, transparent, transparent 4px, rgba(0,0,0,.08) 4px, rgba(0,0,0,.08) 5px), linear-gradient(170deg, #4a7a4a, #3a6a3a, #4a7a4a);
}
.cell.t-forest {
  background: linear-gradient(180deg, #0e3a0e 0%, #1a5a1a 50%, #0e3a0e 100%);
  background-image: radial-gradient(ellipse at 25% 30%, #104010 0%, transparent 45%), radial-gradient(ellipse at 65% 25%, #104010 0%, transparent 40%), radial-gradient(ellipse at 45% 50%, #0c4a0c 0%, transparent 35%), linear-gradient(180deg, #0e3a0e, #1a5a1a);
  box-shadow: inset 0 0 16px rgba(0,100,0,.6);
}
.cell.t-mountain {
  background: linear-gradient(180deg, #7a7a8a 0%, #5a5a6a 30%, #3a3a4a 100%);
  background-image: linear-gradient(135deg, rgba(255,255,255,.12) 25%, transparent 25%, transparent 50%, rgba(255,255,255,.08) 50%, rgba(255,255,255,.08) 75%, transparent 75%), linear-gradient(180deg, #7a7a8a, #3a3a4a);
  box-shadow: inset 0 -8px 16px rgba(0,0,0,.6), inset 0 3px 6px rgba(255,255,255,.12);
}
.cell.t-water {
  background: linear-gradient(90deg, #1a4090, #2a5aaa, #1a4090);
  background-size: 200% 100%;
  animation: waterRipple 4s ease-in-out infinite;
  box-shadow: inset 0 0 22px rgba(30,120,220,.45);
}
@keyframes waterRipple { 0%, 100% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } }

.cell.t-swamp {
  background: linear-gradient(180deg, #2e4220 0%, #1e3015 60%, #2e4220 100%);
  background-image: radial-gradient(circle at 30% 70%, rgba(90,120,0,.35) 0%, transparent 40%), radial-gradient(circle at 70% 40%, rgba(70,90,0,.3) 0%, transparent 35%), linear-gradient(180deg, #2e4220, #1e3015, #2e4220);
  box-shadow: inset 0 0 16px rgba(80,90,0,.5);
}
.cell.t-hill {
  background: linear-gradient(180deg, #7a7a44 0%, #6a6a34 50%, #5a5a28 100%);
  box-shadow: inset 0 -5px 12px rgba(0,0,0,.35), inset 0 3px 5px rgba(255,255,200,.1);
}
.cell.t-volcano {
  background: radial-gradient(ellipse at 50% 60%, #8a3010 0%, #5a2018 50%, #30100a 100%);
  box-shadow: inset 0 0 24px rgba(255,80,0,.4);
  animation: volcanoGlow 2.5s ease-in-out infinite;
}
@keyframes volcanoGlow {
  0%, 100% { box-shadow: inset 0 0 18px rgba(255,80,0,.3); }
  50% { box-shadow: inset 0 0 32px rgba(255,130,30,.55); }
}
.cell.t-ruins {
  background: linear-gradient(135deg, #3e2e55 0%, #524068 50%, #3e2e55 100%);
  background-image: repeating-linear-gradient(0deg, transparent, transparent 6px, rgba(168,85,245,.06) 6px, rgba(168,85,245,.06) 7px), linear-gradient(135deg, #3e2e55, #524068, #3e2e55);
  animation: ruinsShimmer 4s ease-in-out infinite;
}
@keyframes ruinsShimmer {
  0%, 100% { box-shadow: inset 0 0 12px rgba(168,85,245,.25); }
  50% { box-shadow: inset 0 0 26px rgba(168,85,245,.5); }
}

/* Height classes */
.cell.h-1::before, .cell.h-2::before, .cell.h-3::before {
  content: '';
  position: absolute;
  inset: 0;
  pointer-events: none;
  border-radius: 3px;
  z-index: 1;
}
.cell.h-1::before { box-shadow: inset 0 -3px 6px rgba(0,0,0,.3), inset 0 1px 2px rgba(255,255,255,.06); border-bottom: 1px solid rgba(0,0,0,.2); }
.cell.h-2::before { box-shadow: inset 0 -5px 10px rgba(0,0,0,.4), inset 0 2px 4px rgba(255,255,255,.1); border-bottom: 2px solid rgba(0,0,0,.25); }
.cell.h-3::before { box-shadow: inset 0 -7px 14px rgba(0,0,0,.5), inset 0 3px 6px rgba(255,255,255,.14); border-bottom: 3px solid rgba(0,0,0,.3); }

/* Highlights */
.cell.hl-deploy { box-shadow: inset 0 0 0 2px #4a4, 0 0 8px rgba(60,200,60,.3); }
.cell.hl-move { box-shadow: inset 0 0 0 2px #48f, 0 0 8px rgba(60,100,255,.3); }
.cell.hl-attack { box-shadow: inset 0 0 0 2px #f44, 0 0 8px rgba(255,60,60,.4); }
.cell.hl-selected { box-shadow: inset 0 0 0 2px var(--gold), 0 0 12px rgba(212,168,67,.4); }

/* Drag & Drop */
.cell.drag-valid { animation: dragPulse 1s ease-in-out infinite; z-index: 2; }
.cell.drag-valid::after { content: ''; position: absolute; inset: 0; border: 2px solid rgba(60,220,60,.6); border-radius: 3px; pointer-events: none; }
@keyframes dragPulse { 0%, 100% { box-shadow: inset 0 0 8px rgba(60,220,60,.2); } 50% { box-shadow: inset 0 0 18px rgba(60,220,60,.45); } }
.cell.drag-hover { transform: scale(1.08); box-shadow: inset 0 0 20px rgba(60,255,60,.5), 0 0 12px rgba(60,220,60,.4) !important; z-index: 3; }
.cell.drag-invalid { opacity: .4; filter: saturate(.3); }

/* Unit Token */
.unit-token {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  width: 90%;
  height: 85%;
  border-radius: 4px;
  border: 2px solid #888;
  font-size: 10px;
  font-weight: bold;
  line-height: 1.2;
  text-align: center;
  position: relative;
  padding: 1px;
}
.unit-token.owner-0 { border-color: #4a8af5; background: rgba(30,60,120,.7); }
.unit-token.owner-1 { border-color: #f54a4a; background: rgba(120,30,30,.7); }
.unit-token .u-name {
  font-size: 0;
  opacity: 0;
  position: absolute;
  top: -18px;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(0,0,0,.85);
  color: var(--text);
  padding: 2px 6px;
  border-radius: 3px;
  white-space: nowrap;
  pointer-events: none;
  transition: opacity .15s, font-size 0s;
  z-index: 10;
}
.unit-token:hover .u-name { font-size: 9px; opacity: 1; }
.unit-token .u-stats { display: flex; justify-content: space-between; width: 100%; position: absolute; bottom: 0; left: 0; right: 0; padding: 0 2px; }
.unit-token .u-atk { color: #fff; font-size: 9px; font-weight: bold; background: rgba(200,50,50,.7); padding: 0 3px; border-radius: 2px; line-height: 1.4; }
.unit-token .u-hp { color: #fff; font-size: 9px; font-weight: bold; background: rgba(50,160,50,.7); padding: 0 3px; border-radius: 2px; line-height: 1.4; }
.unit-token .u-stars { color: var(--gold); font-size: 8px; position: absolute; top: 0; right: 2px; }
.unit-token .u-kw { position: absolute; top: 0; left: 2px; display: flex; gap: 1px; }
.unit-token .u-kw .kw-icon { width: 10px; height: 10px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 6px; background: rgba(0,0,0,.6); color: #ddd; line-height: 1; }
.unit-token.is-structure { border-style: dashed; border-color: #aaa; }
.unit-token.exhausted { opacity: .6; }
.u-art { width: 36px; height: 36px; margin: 0 auto 1px; }
.u-art svg { width: 100%; height: 100%; }

/* Player bars */
.player-bar {
  display: flex;
  align-items: center;
  gap: 15px;
  padding: 8px 15px;
  background: linear-gradient(90deg, var(--bg2), #161638, var(--bg2));
  border-image: linear-gradient(90deg, transparent, #3a3a6a, transparent) 1;
  min-height: 60px;
  flex-wrap: wrap;
}
.player-bar.p2 { border-bottom: 2px solid; border-image: linear-gradient(90deg, transparent, #3a3a6a, transparent) 1; }
.player-bar.p1 { border-top: 2px solid; border-bottom: none; border-image: linear-gradient(90deg, transparent, #3a3a6a, transparent) 1; }
.titan-portrait {
  width: 44px;
  height: 44px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 22px;
  font-weight: bold;
  border: 2px solid var(--gold);
  box-shadow: 0 0 10px rgba(212,168,67,.2);
}
.hp-bar-outer { width: 140px; height: 18px; background: #222; border-radius: 9px; overflow: hidden; border: 1px solid #555; box-shadow: inset 0 1px 3px rgba(0,0,0,.5); }
.hp-bar-inner {
  height: 100%;
  background: linear-gradient(90deg, #8b1a1a, #c0392b, #e74c3c);
  transition: width .3s;
  border-radius: 9px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 11px;
  font-weight: bold;
  min-width: 24px;
  color: #fff;
  text-shadow: 0 0 3px #000, 0 0 3px #000, 0 1px 2px #000;
  letter-spacing: 0.5px;
  padding: 0 6px;
  box-shadow: inset 0 0 0 1px rgba(0,0,0,.3);
}
.energy-display { 
  display: flex; 
  align-items: center; 
  gap: 4px; 
  font-size: 1.1em; 
  font-weight: bold; 
  color: var(--mana-blue, #4a9eff); 
}
.deploy-display { 
  font-size: .9em; 
  color: var(--gold);
  min-width: 100px;
  text-align: center;
}
.deploy-display.deploy-empty {
  visibility: hidden;
  min-width: 100px;
}
.titan-ability-btn { padding: 4px 10px; font-size: 12px; background: #2a2a5a; color: var(--arcane); border: 1px solid var(--arcane); border-radius: 4px; }
.titan-ability-btn:hover { background: #3a3a7a; }
.titan-ability-btn:disabled { opacity: .4; cursor: not-allowed; }

/* Sidebar */
.sidebar {
  width: 220px;
  background: linear-gradient(180deg, var(--bg2) 0%, #0d0d22 100%);
  border-left: 2px solid #2a2a5a;
  display: flex;
  flex-direction: column;
  overflow: hidden;
  flex-shrink: 0;
}
.phase-section { padding: 10px; border-bottom: 1px solid #333; }
.phase-list { display: flex; flex-direction: column; gap: 3px; margin: 8px 0; }
.phase-item { padding: 4px 8px; border-radius: 3px; font-size: 12px; color: var(--dim); background: var(--bg); }
.phase-item.active {
  background: var(--bg3);
  color: var(--gold);
  font-weight: bold;
  border: 1px solid var(--gold);
  position: relative;
  overflow: hidden;
}
.phase-item.active::after {
  content: '';
  position: absolute;
  left: 0;
  bottom: 0;
  height: 2px;
  background: linear-gradient(90deg, var(--gold), #fff8, var(--gold));
  animation: phaseProgress 1.5s ease-out forwards;
  width: 100%;
}
@keyframes phaseProgress { 0% { width: 0; opacity: 0; } 20% { opacity: 1; } 100% { width: 100%; } }
.phase-item.done { color: #555; text-decoration: line-through; }
.log-section { flex: 1; overflow-y: auto; padding: 10px; font-size: 11px; }
.log-section .log-entry { padding: 3px 0; border-bottom: 1px solid #1a1a2a; color: var(--dim); }
.log-section .log-entry:last-child { color: var(--text); }
.log-section .log-empty { 
  color: var(--dim); 
  font-style: italic; 
  text-align: center; 
  padding: 20px 10px;
  opacity: 0.6;
}

/* Hand */
.hand-section {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 8px 12px;
  background: linear-gradient(180deg, var(--bg2), #0d0d22);
  border-top: 2px solid;
  border-image: linear-gradient(90deg, transparent, #3a3a6a, transparent) 1;
  overflow-x: auto;
  min-height: 150px;
}

/* Mobile Responsiveness */
@media (max-width: 900px) {
  .sidebar { width: 160px; }
  .card { width: 90px; min-width: 90px; height: 130px; }
  .sidebar .phase-item { font-size: 10px; }
  .board { max-width: 100%; max-height: 500px; }
  .hp-bar-outer { width: 100px; }
  .titan-portrait { width: 36px; height: 36px; font-size: 18px; }
}

@media (max-width: 700px) { 
  .sidebar { display: none; } 
  .board { 
    max-height: 400px;
    gap: 2px;
  }
  .cell { min-height: 30px; font-size: 9px; }
  .unit-token .u-atk, .unit-token .u-hp { font-size: 7px; }
  .player-bar { padding: 6px 10px; gap: 10px; min-height: 50px; }
  .hand-section { min-height: 120px; padding: 6px; }
  .card { width: 70px; min-width: 70px; height: 105px; }
}

@media (max-width: 480px) {
  .game-screen { overflow: auto; }
  .board { max-height: 320px; }
  .cell { min-height: 25px; }
  .player-bar { flex-wrap: wrap; gap: 5px; }
  .player-bar > *:not(.titan-portrait):not(.hp-bar-outer) { font-size: 11px; }
  .hp-bar-outer { width: 80px; height: 14px; }
  .hp-bar-inner { font-size: 9px; }
  .hand-section { min-height: 100px; gap: 4px; }
  .card { width: 60px; min-width: 60px; height: 90px; }
  .unit-token { width: 95%; height: 90%; }
  .u-art { width: 24px; height: 24px; }
}

/* Touch-friendly improvements */
@media (hover: none) {
  .cell:hover { filter: none; }
  .cell:active { filter: brightness(1.3); }
  .unit-token:hover .u-name { display: none; }
  .card:hover { transform: none; }
}
